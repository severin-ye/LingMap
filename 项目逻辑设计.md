å¾ˆå¥½ã€‚ä¸‹é¢æ˜¯å¯¹ä½ è¿™ä¸ªé¡¹ç›®ï¼ˆåŸºäºR2æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆã€Šå‡¡äººä¿®ä»™ä¼ ã€‹ä¸­â€œå¤©æåœ°å®+ä¸»è¦äº‹ä»¶â€çš„å› æœå›¾è°±ï¼‰çš„**å®Œæ•´ç³»ç»Ÿçº§ Workflow ç²¾ç»†åŒ–è®¾è®¡**ï¼Œä»è¾“å…¥åˆ°è¾“å‡ºï¼Œæ¯ä¸€ç¯èŠ‚åŒ…æ‹¬ï¼š

- æ¨¡å—åç§°
- æ‰€éœ€è¾“å…¥/è¾“å‡ºæ ¼å¼ï¼ˆå¸¦å­—æ®µï¼‰
- è°ƒç”¨æŠ€æœ¯/æ¨¡å‹/ç®—æ³•
- ç¤ºä¾‹æ•°æ®ä¸å¤„ç†é€»è¾‘
- æ£€æŸ¥ç‚¹ä¸é”™è¯¯æ§åˆ¶æœºåˆ¶

---

# âœ… é¡¶å±‚å·¥ä½œæµæ€»è§ˆï¼ˆOverall Pipelineï¼‰

```mermaid
graph TD
    A0[å°è¯´ç« èŠ‚åŸæ–‡] --> A1[é¢„å¤„ç†ä¸åˆ†æ®µ]
    A1 --> B1[Reader - åˆæ­¥äº‹ä»¶ä¸å®ç‰©æå–]
    B1 --> B2[HAR - å¹»è§‰æ£€æµ‹ä¸ä¿®æ­£]
    B2 --> C1[CPC - å› æœå…³ç³»æŠ½å–]
    C1 --> C2[CPC - å»ç¯ä¸æƒé‡å›¾æ„å»º]
    C2 --> D1[GraphBuilder - Mermaidè¾“å‡ºç”Ÿæˆ]

```

---

## ğŸ”¹ STEP A0ï¼šåŸå§‹æ–‡æœ¬å‡†å¤‡

- **è¾“å…¥**ï¼šåŸå§‹å°è¯´txtæ–‡ä»¶ï¼ˆä¾‹å¦‚å‡¡äººä¿®ä»™ä¼ å…¨é›†ï¼‰
- **ä»»åŠ¡**ï¼šåˆ†ç« èŠ‚æ¸…æ´— + æ ‡å‡†åŒ–ä¸ºJSONæ ¼å¼

### è¾“å…¥ç¤ºä¾‹ï¼ˆrawï¼‰ï¼š

```
ã€ç¬¬åäº”ç«  èšçµä¸¹ã€‘
éŸ©ç«‹ä»å‚¨ç‰©è¢‹ä¸­å–å‡ºä¸€é¢—çµä¹³â€¦â€¦ä»–æ„Ÿåˆ°çµåŠ›ç¿»æ¶Œâ€¦â€¦

```

### è¾“å‡ºæ ¼å¼ï¼š

```json
{
  "chapter_id": "ç¬¬åäº”ç« ",
  "title": "èšçµä¸¹",
  "content": "éŸ©ç«‹ä»å‚¨ç‰©è¢‹ä¸­å–å‡ºä¸€é¢—çµä¹³â€¦â€¦"
}

```

---

## ğŸ”¹ STEP A1ï¼šæ–‡æœ¬æ ‡å‡†åŒ–ä¸åˆ†æ®µ

- **è¾“å…¥**ï¼šåŸå§‹ç« èŠ‚æ–‡æœ¬
- **è¾“å‡º**ï¼šæŒ‰æ®µ/äº‹ä»¶ç²—åˆ†çš„ç»“æ„åŒ–æ–‡æœ¬
- **å¤„ç†æ–¹æ³•**ï¼šæŒ‰ç©ºè¡Œ/æ ‡ç‚¹åˆ†å¥ï¼Œä¿æŒé€»è¾‘å®Œæ•´æ€§

### è¾“å‡ºç»“æ„ï¼š

```json
{
  "chapter_id": "ç¬¬åäº”ç« ",
  "segments": [
    {
      "seg_id": "ç¬¬åäº”ç« -1",
      "text": "éŸ©ç«‹å–å‡ºçµä¹³æœä¸‹..."
    },
    {
      "seg_id": "ç¬¬åäº”ç« -2",
      "text": "éŸ©ç«‹æ„Ÿåˆ°ç»è„‰å‘çƒ­..."
    }
  ]
}

```

---

## ğŸ”¹ STEP B1ï¼šReader - LLMä¿¡æ¯æŠ½å–

- **è¾“å…¥**ï¼šç« èŠ‚åˆ†æ®µæ–‡æœ¬
- **ä»»åŠ¡**ï¼šä»æ¯æ®µæ–‡æœ¬ä¸­æŠ½å–äº‹ä»¶ï¼ˆeventï¼‰ã€å®ç‰©ï¼ˆtreasureï¼‰ã€è§’è‰²ï¼ˆcharacterï¼‰
- **è°ƒç”¨æ¨¡å‹**ï¼šGPT-4o / Claude 3
- **è¾“å‡º**ï¼šç»“æ„åŒ–äº‹ä»¶æ¡ç›®ï¼ˆæ¯æ®µ â†’ å¤šäº‹ä»¶ï¼‰

### ç¤ºä¾‹ Promptï¼š

```
è¯·ä»ä¸‹åˆ—å°è¯´æ®µè½ä¸­æå–å…³é”®äº‹ä»¶ã€æ¶‰åŠå®ç‰©ã€äººç‰©ä»¥åŠäº‹ä»¶çš„ç»“æœä¸èƒŒæ™¯ï¼Œè¾“å‡ºä¸ºæ ‡å‡†JSONç»“æ„ã€‚

```

### è¾“å‡ºæ ¼å¼ï¼š

```json
{
  "event_id": "E15-2",
  "description": "éŸ©ç«‹æœç”¨çµä¹³çªç ´è‡³ç­‘åŸº",
  "treasures": ["çµä¹³"],
  "characters": ["éŸ©ç«‹"],
  "result": "ä¿®ä¸ºå¤§è¿›",
  "location": "æ´åºœå†…",
  "time": "å¤œé—´"
}

```

---

## ğŸ”¹ STEP B2ï¼šHAR - å¹»è§‰æ£€æµ‹ä¸ç²¾ä¿®

- **è¾“å…¥**ï¼šäº‹ä»¶æŠ½å–ç»“æœ + æ”¯æŒä¸Šä¸‹æ–‡
- **ä»»åŠ¡**ï¼šæ£€æµ‹äº‹å®é”™è¯¯ã€è¯­è¨€ä¸ä¸€è‡´ã€æ¦‚å¿µæ··ä¹±
- **å®ç°**ï¼š
    - LLMè¾“å‡ºâ€œæ½œåœ¨å¹»è§‰ä½ç½®â€ + ä¿®å¤å»ºè®®
    - ä½¿ç”¨ `prefine prompt` è¿›è¡Œé‡å†™
    - åˆå¹¶é‡å†™ç»“æœ â†’ æ›´æ–°äº‹ä»¶ä¿¡æ¯

### ç¤ºä¾‹æ£€æµ‹ç»“æœï¼š

```json
{
  "loc": "event.treasure",
  "suggestion": "â€˜äº”è‰²çµä¹³â€™åº”ä¸ºâ€˜çµä¹³â€™ï¼Œäº”è‰²çµä¹³å‡ºç°åœ¨åæœŸå‰§æƒ…"
}

```

---

## ğŸ”¹ STEP C1ï¼šCausal Pair Extractionï¼ˆå› æœå…³ç³»è¯†åˆ«ï¼‰

- **è¾“å…¥**ï¼šå…¨éƒ¨å·²æ¸…æ´—çš„äº‹ä»¶
- **ç›®æ ‡**ï¼šå‘ç°äº‹ä»¶ä¹‹é—´çš„å› æœå¯¹ï¼Œå¹¶åˆ¤æ–­å¼ºåº¦
- **å®ç°æ–¹å¼**ï¼š
    - æ¯ä¸¤äº‹ä»¶å¯¹ä½œä¸ºpromptè¾“å…¥
    - LLMåˆ¤æ–­æ˜¯å¦å­˜åœ¨å› æœå…³ç³»ï¼Œå¹¶ç»™å‡ºå¼ºåº¦æ ‡ç­¾ï¼ˆé«˜/ä¸­/ä½ï¼‰

### Promptç‰‡æ®µç¤ºä¾‹ï¼š

```
äº‹ä»¶1ï¼šéŸ©ç«‹æœç”¨çµä¹³çªç ´ç­‘åŸº
äº‹ä»¶2ï¼šå¢¨å¤§å¤«æ„Ÿåˆ°å¨èƒï¼Œä¸‹ä»¤è¿½æ€éŸ©ç«‹
æ˜¯å¦å­˜åœ¨å› æœå…³ç³»ï¼Ÿå¦‚æœæœ‰ï¼Œè¯·è¯´æ˜æ–¹å‘ã€å¼ºåº¦ï¼Œå¹¶ç®€è¦è§£é‡Šã€‚

```

### è¾“å‡ºæ ¼å¼ï¼š

```json
{
  "from": "E15-2",
  "to": "E15-3",
  "strength": "é«˜",
  "reason": "å› ä¿®ä¸ºæå‡å¼•èµ·æ•Œå¯¹æ€€ç–‘"
}

```

---

## ğŸ”¹ STEP C2ï¼šCPC - DAGæ„å»ºï¼ˆå»ç¯+åŠ æƒï¼‰

- **è¾“å…¥**ï¼šå› æœå¯¹åˆ—è¡¨
- **ç›®æ ‡**ï¼šæ„å»ºæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼Œé¿å…çŸ›ç›¾å¾ªç¯
- **ç®—æ³•**ï¼šè´ªå¿ƒæ–­ç¯ï¼ˆæƒé‡ä¼˜å…ˆ + å…¥åº¦æ’åºï¼‰

### å†…éƒ¨é€»è¾‘ï¼š

1. æ‰€æœ‰äº‹ä»¶ä½œä¸ºèŠ‚ç‚¹
2. äº‹ä»¶å¯¹æŒ‰å¼ºåº¦æ’åºï¼šé«˜ > ä¸­ > ä½
3. è‹¥æŸè¾¹å½¢æˆå›ç¯ â†’ åˆ é™¤å¼±è¾¹
4. æœ€ç»ˆå½¢æˆæœ€å°è¦†ç›–çš„å¼ºå› æœé“¾å›¾

### è¾“å‡ºç»“æ„ï¼š

```json
{
  "nodes": ["E15-2", "E15-3", "E15-4"],
  "edges": [
    {"from": "E15-2", "to": "E15-3", "strength": "é«˜"},
    {"from": "E15-3", "to": "E15-4", "strength": "ä¸­"}
  ]
}

```

---

## ğŸ”¹ STEP D1ï¼šMermaid å›¾è¾“å‡ºæ¨¡å—

- **è¾“å…¥**ï¼šDAG å›¾ç»“æ„ï¼ˆnodes + edgesï¼‰
- **ä»»åŠ¡**ï¼šå°†å›¾æ¸²æŸ“ä¸º Mermaid æ ¼å¼å¹¶æ ‡è®°èŠ‚ç‚¹ç±»å‹
- **å®ç°æ–¹å¼**ï¼š
    - èŠ‚ç‚¹é¢œè‰²åŒºåˆ†ç±»å‹ï¼ˆå®ç‰©äº‹ä»¶/äººç‰©è¡Œä¸º/æ•Œå¯¹å†²çªï¼‰
    - å¯åŠ  click é“¾æ¥ / tooltipsï¼ˆMermaid æ”¯æŒï¼‰

### Mermaid è¾“å‡ºç¤ºä¾‹ï¼š

```mermaid
graph TD
    E1[éŸ©ç«‹æœç”¨çµä¹³] --> E2[çªç ´ç­‘åŸº]
    E2 --> E3[å¢¨å¤§å¤«æ´¾äººè¿½æ€]
    E3 --> E4[éŸ©ç«‹è—å…¥æ´åºœè·å¾—ä¿®ç‚¼ç©ºé—´]

    style E1 fill:#BDE5F8,stroke:#2C82C9
    style E2 fill:#FDF6B2,stroke:#C19400
    style E3 fill:#FCDCDC,stroke:#C74343

```

---

## ğŸ”¹ æ£€æŸ¥ç‚¹è®¾è®¡ï¼ˆæ¯ä¸€æ­¥çš„æ–­ç‚¹éªŒè¯ï¼‰

| æ­¥éª¤ | éªŒè¯æ–¹å¼ | é”™è¯¯å¤„ç†å»ºè®® |
| --- | --- | --- |
| æ–‡æœ¬åˆ‡åˆ† | ç« èŠ‚æ€»æ•°/æ˜¯å¦ä¹±ç  | ä½¿ç”¨æ ‡é¢˜åŒ¹é…æ–­ç‚¹å›æ»š |
| äº‹ä»¶æŠ½å– | æ˜¯å¦åŒ…å«ç©ºå­—æ®µ | å›é€€ä½¿ç”¨æ ‡å‡†æç¤ºè¯å†è·‘ä¸€è½® |
| HARä¿®æ­£ | æ˜¯å¦ä¸æ”¯æŒæ–‡æœ¬ä¸€è‡´ | æ ‡æ³¨â€œæœªè§£å†³â€æ ‡å¿—äº¤äººå·¥å®¡æ ¸ |
| å› æœè¯†åˆ« | æ˜¯å¦é‡å¤/è‡ªå¾ªç¯ | è‡ªåŠ¨å‰”é™¤æ— æ•ˆè¾¹å¯¹ |
| Mermaidç”Ÿæˆ | æ˜¯å¦æ ¼å¼åˆè§„ | æ ¡éªŒMermaidè¯­æ³•å†è¾“å‡º |

---

## ğŸ”š æ€»ç»“ï¼šå®Œæ•´å¤„ç†æµï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰

```mermaid
graph TD
    T0[ğŸ“˜ åŸå§‹å°è¯´æ–‡æœ¬] --> T1[ğŸ”¤ æ–‡æœ¬é¢„å¤„ç†]
    T1 --> T2[ğŸ“š åˆ†æ®µ+æ¸…æ´—JSON]
    T2 --> T3[ğŸ§  Reader: äº‹ä»¶/å®ç‰©/è§’è‰²æŠ½å–]
    T3 --> T4[ğŸ§¹ HARä¿®æ­£]
    T4 --> T5[ğŸ”— Causal Pair æ„å»º]
    T5 --> T6[ğŸ“Š DAG æ„å»ºï¼ˆå»ç¯ï¼‰]
    T6 --> T7[ğŸ“ˆ Mermaidè¾“å‡ºç”Ÿæˆ]

```

---