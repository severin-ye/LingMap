ä»¥ä¸‹æ˜¯ä¸ºä½ é‡èº«å®šåˆ¶çš„ **å•äººé¡¹ç›®å¼€å‘è®¡åˆ’ï¼ˆä»…è€ƒè™‘å¼€å‘é¡ºåºï¼‰**ï¼Œé’ˆå¯¹â€œåŸºäºR2çš„ã€Šå‡¡äººä¿®ä»™ä¼ ã€‹å› æœäº‹ä»¶å›¾è°±ç”Ÿæˆç³»ç»Ÿâ€ï¼Œç»“åˆä½ çš„æ¶æ„åå¥½ï¼ŒæŒ‰**æ¨¡å—ä¼˜å…ˆçº§ã€ä¾èµ–å…³ç³»ã€å¼€å‘ç²’åº¦**åˆ¶å®šï¼Œç¡®ä¿ï¼š

* æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆå®ç°ï¼ˆäº‹ä»¶è¯†åˆ«ä¸å› æœæ¨ç†ï¼‰
* å•æ¨¡å—å¯æµ‹å¯è°ƒï¼ˆè§£è€¦ï¼Œåˆ©äºæµ‹è¯•ï¼‰
* é€æ­¥é›†æˆä¸ç»„è£…ï¼Œä¿æŒå¯è¿è¡Œæ€§

---

## ğŸ“Œ å¼€å‘é¡ºåºæ€»è§ˆï¼ˆæŒ‰é˜¶æ®µï¼‰

| é˜¶æ®µ | å¼€å‘ç›®æ ‡                  | æ¨¡å—/æ–‡ä»¶                                 |
| -- | --------------------- | ------------------------------------- |
| 1  | æ­å»ºæ ¸å¿ƒç»“æ„ä¸æ¥å£ï¼ˆæŠ½è±¡+æ•°æ®æ¨¡å‹ï¼‰    | common/                               |
| 2  | å®ç°è¾“å…¥ç«¯ä¸äº‹ä»¶æŠ½å–ä¸»æµç¨‹ï¼ˆReaderï¼‰ | text\_ingestion/ + event\_extraction/ |
| 3  | æ¥å…¥å¹»è§‰ä¿®å¤æ¨¡å—ï¼ˆHARï¼‰         | hallucination\_refine/                |
| 4  | å®ç°å› æœé“¾æ„å»ºæ¨¡å—ï¼ˆCPCï¼‰        | causal\_linking/                      |
| 5  | å®ç°å›¾è°±æ„å»ºä¸å¯è§†åŒ–è¾“å‡º          | graph\_builder/                       |
| 6  | æ„å»ºç»Ÿä¸€å…¥å£ï¼ˆCLIæ¥å£/APIæ¥å£ï¼‰   | api\_gateway/                         |
| 7  | å•å…ƒæµ‹è¯• & ç¤ºä¾‹å›¾è°±æµ‹è¯•         | tests/                                |

---

## âœ… é˜¶æ®µ 1ï¼šæŠ½è±¡æ¥å£ä¸é€šç”¨æ¨¡å‹å‡†å¤‡ï¼ˆåŸºç¡€éª¨æ¶ï¼‰

ğŸ“ `common/models/`

* `event.py`ï¼šå®šä¹‰ `EventItem` æ•°æ®ç»“æ„ï¼ˆåŒ…å«è§’è‰²ã€å®ç‰©ã€æè¿°ã€ç« èŠ‚ç­‰ï¼‰
* `chapter.py`ï¼šå®šä¹‰ `Chapter` æ•°æ®ç»“æ„
* `causal_edge.py`ï¼šäº‹ä»¶å› æœè¾¹ç»“æ„
* `treasure.py`ï¼šå¤©æåœ°å®ç»“æ„ï¼ˆå¯é€‰ï¼‰

ğŸ“ `common/interfaces/`

* `extractor.py`ï¼šå®šä¹‰ `AbstractExtractor` æ¥å£
* `refiner.py`ï¼šå®šä¹‰ `AbstractRefiner` æ¥å£
* `linker.py`ï¼šå®šä¹‰ `AbstractLinker` æ¥å£
* `graph_renderer.py`ï¼šå®šä¹‰ `AbstractGraphRenderer`

ğŸ“ `common/utils/`

* `json_loader.py`ï¼šç”¨äºè¯»å–é…ç½®/ç« èŠ‚JSONæ–‡ä»¶
* `text_splitter.py`ï¼šç« èŠ‚åˆ†å¥åˆ‡åˆ†å™¨

ğŸ“ `common/config/`

* JSON é…ç½®æ ·ä¾‹ + prompt æ¨¡æ¿ç¤ºä¾‹

---

## âœ… é˜¶æ®µ 2ï¼šReader ä¸»æµç¨‹å¼€å‘

ğŸ“ `text_ingestion/`

* `chapter_loader.py`ï¼šä»txtæ–‡ä»¶åŠ è½½å¹¶åˆ‡åˆ†ä¸ºç« èŠ‚JSONï¼ˆæµ‹è¯•ç›®æ ‡è¾“å…¥ï¼‰
* `app.py`ï¼šå•å…ƒæµ‹è¯•ç”¨æ‰§è¡Œå…¥å£

ğŸ“ `event_extraction/`

* `domain/base_extractor.py`ï¼šç»§æ‰¿ `AbstractExtractor`
* `service/extractor_service.py`ï¼šæ„å»ºä¸»é€»è¾‘ï¼Œå®Œæˆ prompt æ‹¼æ¥ä¸ LLM è°ƒç”¨
* `repository/llm_client.py`ï¼šå°è£… OpenAI æ¥å£
* `di/provider.py`ï¼šæ³¨å†Œ extractor å®ç°ç±»
* `controller/extractor_controller.py`ï¼šæä¾›æœ¬åœ°è¿è¡Œå…¥å£ï¼ˆå¯æ‰¹å¤„ç†ï¼‰

ç›®æ ‡äº§å‡ºï¼šèƒ½ä»ç« èŠ‚JSONä¸­æ‰¹é‡ç”Ÿæˆç»“æ„åŒ–äº‹ä»¶ä¸å®ç‰©æ•°æ®

---

## âœ… é˜¶æ®µ 3ï¼šHAR æ¨¡å—å¼€å‘ï¼ˆHallucination ä¿®å¤ï¼‰

ğŸ“ `hallucination_refine/`

* `domain/base_refiner.py`ï¼šå®šä¹‰ `AbstractRefiner` æ¥å£
* `service/har_service.py`ï¼šå®ç°è¿­ä»£ä¿®å¤é€»è¾‘ï¼ˆå‚è€ƒè®ºæ–‡ä¼ªä»£ç ï¼‰
* `repository/llm_client.py`ï¼šå¤ç”¨ event\_extraction æ¨¡å—çš„ LLM æ¥å£
* `di/provider.py`ï¼šæ³¨å†Œ refiner
* `controller/har_controller.py`ï¼šæµ‹è¯•ç”¨æœ¬åœ°å…¥å£

ç›®æ ‡äº§å‡ºï¼šèƒ½æ£€æµ‹å¹¶ä¿®å¤äº‹ä»¶ä¸­çš„å¹»è§‰ã€é”™è¯¯æœ¯è¯­

---

## âœ… é˜¶æ®µ 4ï¼šå› æœé“¾æ„å»ºæ¨¡å—ï¼ˆCPCï¼‰

ğŸ“ `causal_linking/`

* `domain/base_linker.py`ï¼šå®šä¹‰ `AbstractLinker`
* `service/linker_service.py`ï¼šä¸¤ä¸¤äº‹ä»¶ä¹‹é—´åˆ¤æ–­å› æœï¼ˆprompt + LLMï¼‰
* `service/graph_filter.py`ï¼šå®ç°å»ç¯ã€è´ªå¿ƒç®—æ³•ä¿ç•™å¼ºè¾¹
* `di/provider.py`ï¼šæ³¨å†Œ Linker
* `controller/linker_controller.py`ï¼šæµ‹è¯•å…¥å£

ç›®æ ‡äº§å‡ºï¼šä»äº‹ä»¶é›†ä¸­æ„å»ºå‡º Directed Acyclic Graphï¼ˆDAGï¼‰

---

## âœ… é˜¶æ®µ 5ï¼šMermaid å›¾è°±è¾“å‡º

ğŸ“ `graph_builder/`

* `domain/base_renderer.py`ï¼šå®šä¹‰ `AbstractGraphRenderer`
* `service/mermaid_renderer.py`ï¼šå®ç° Mermaid å›¾è¾“å‡ºé€»è¾‘
* `controller/graph_controller.py`ï¼šä¼ å…¥ DAG â†’ è¾“å‡º Mermaid æ–‡æœ¬
* `utils/color_map.py`ï¼šæ ¹æ®äº‹ä»¶ç±»å‹ç”Ÿæˆ Mermaid èŠ‚ç‚¹é¢œè‰²

ç›®æ ‡äº§å‡ºï¼šå¯è§†åŒ–è¾“å‡º `.mmd` Mermaid å›¾ä»£ç 

---

## âœ… é˜¶æ®µ 6ï¼šé›†æˆä¸ç»Ÿä¸€è°ƒç”¨æ¥å£ï¼ˆCLI æˆ– RESTï¼‰

ğŸ“ `api_gateway/`

* `main.py`ï¼šæ”¯æŒ CLI æŒ‡ä»¤è¡Œæ‰§è¡Œæµç¨‹ï¼ˆä¾‹å¦‚ä»txtè¾“å…¥ â†’ è¾“å‡ºå›¾è°±ï¼‰
* `router/`ï¼ˆå¯é€‰ï¼‰ï¼š

  * FastAPI å®ç° REST æœåŠ¡å…¥å£ï¼ˆæœªæ¥æ‰©å±•ï¼‰

ğŸ“ `scripts/`

* `demo_run.py`ï¼šè·‘é€šä»è¾“å…¥ç« èŠ‚ â†’ è¾“å‡ºå›¾è°±çš„ End-to-End æµç¨‹æ ·ä¾‹

---

## âœ… é˜¶æ®µ 7ï¼šæµ‹è¯•ä¸æ ·ä¾‹è¿è¡Œ

ğŸ“ `tests/`

* `test_event_extraction.py`ï¼šäº‹ä»¶æå–æ¨¡å—å•æµ‹
* `test_har_module.py`ï¼šHAR ç²¾ä¿®æ¨¡å—æµ‹è¯•
* `test_causal_linking.py`ï¼šå› æœè¯†åˆ«æ¨¡å—æµ‹è¯•
* `test_mermaid_graph.py`ï¼šMermaid æ¸²æŸ“è¾“å‡ºæµ‹è¯•
* ä½¿ç”¨ mock provider å®ç°æ¨¡å—éš”ç¦»æµ‹è¯•

---

## ğŸš¦ å¼€å‘è·¯å¾„è·¯çº¿å›¾ï¼ˆæ€»ç»“ï¼‰

```text
1ï¸âƒ£ å»ºç«‹ models + ABC æ¥å£
2ï¸âƒ£ å®ç° text_ingestion â†’ event_extraction â†’ CLI è·‘é€šäº‹ä»¶æŠ½å–
3ï¸âƒ£ æ·»åŠ  HAR ä¿®å¤ â†’ æ¥å…¥ event_extraction è¾“å‡º
4ï¸âƒ£ å®ç°å› æœåˆ¤æ–­ + å›¾è¿‡æ»¤ï¼ˆDAGï¼‰
5ï¸âƒ£ å®ç° Mermaid è¾“å‡ºæ ¼å¼ + æ¸²æŸ“æ¨¡å—
6ï¸âƒ£ é›†æˆ API/CLI ç»Ÿä¸€è°ƒç”¨
7ï¸âƒ£ åŠ å…¥æµ‹è¯•ä¸å®éªŒå›¾è°±
```

---

å¦‚ä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ï¼š

* ğŸ§± ç”Ÿæˆæ‰€æœ‰æ¨¡å—çš„ Python ä»£ç æ–‡ä»¶éª¨æ¶
* ğŸ§ª å¸®ä½ è®¾è®¡æµ‹è¯•æ•°æ®å’Œ prompt æ¨¡æ¿
* ğŸ–¼ï¸ å¼€å§‹æ„å»ºä»»ä¸€æ¨¡å—çš„å®Œæ•´å®ç°ä»£ç ï¼ˆä¾‹å¦‚ extractorï¼‰

ä½ æƒ³æˆ‘ç°åœ¨å¼€å§‹å“ªä¸€æ­¥ï¼Ÿæ˜¯å¦è¦æˆ‘ç”Ÿæˆæ•´ä¸ªé¡¹ç›®ä»£ç æ¡†æ¶ï¼Ÿ
