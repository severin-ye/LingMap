# 凡人修仙传因果图谱系统 - 文件树结构

本文档展示了项目的完整文件树结构，包含每个文件和目录的功能说明。此结构反映了系统的模块化设计和微服务架构。

```
.
├── FINAL_SYSTEM_REPORT.md      # 系统最终报告，总结项目成果、指标和完成情况
├── README.md                   # 项目说明文档，包含项目概述、安装指南和使用方法
├── api_gateway                 # API网关模块，提供统一的HTTP API接口
│   └── main.py                 # API网关主文件，处理外部请求和各模块间通信
├── causal_linking              # 因果关系链接模块，识别事件之间的因果关系
│   ├── app.py                  # 模块入口文件，提供因果链接服务接口
│   ├── controller              # 控制器目录，处理因果链接相关请求
│   │   └── linker_controller.py  # 因果链接控制器，管理链接请求的处理流程
│   ├── di                      # 依赖注入目录
│   │   └── provider.py         # 依赖注入提供者，管理服务依赖
│   ├── domain                  # 领域模型目录
│   │   └── base_linker.py      # 链接器基类定义
│   ├── repository              # 数据仓库目录（用于存储或访问数据）
│   └── service                 # 服务目录，具体实现因果链接的业务逻辑
│       ├── README.md           # 因果链接服务说明文档
│       ├── base_causal_linker.py  # 基础因果链接实现
│       ├── candidate_generator.py # 因果候选对生成器，生成可能的因果关系候选
│       ├── graph_filter.py     # 图过滤器，用于过滤和优化因果图
│       ├── pair_analyzer.py    # 事件对分析器，分析事件对之间的因果关系
│       ├── unified_linker_service.py  # 统一链接服务，整合因果链接的各个步骤
│       └── unified_linker_service.py.bak  # 统一链接服务的备份文件
├── common                      # 公共组件目录，包含各模块共用的工具和接口
│   ├── config                  # 配置文件目录
│   │   ├── config.json         # 系统主配置文件
│   │   ├── parallel_config.json  # 并行处理配置文件
│   │   ├── prompt_causal_linking.json  # 因果链接LLM提示词配置
│   │   ├── prompt_event_extraction.json  # 事件提取LLM提示词配置
│   │   └── prompt_hallucination_refine.json  # 幻觉修复LLM提示词配置
│   ├── interfaces              # 接口定义目录
│   │   ├── extractor.py        # 事件提取器接口
│   │   ├── graph_renderer.py   # 图形渲染器接口
│   │   ├── linker.py           # 因果链接器接口
│   │   └── refiner.py          # 幻觉修复器接口
│   ├── models                  # 数据模型目录
│   │   ├── causal_edge.py      # 因果边模型，定义事件间的因果关系
│   │   ├── chapter.py          # 章节模型，定义小说章节的数据结构
│   │   ├── event.py            # 事件模型，定义事件的数据结构
│   │   └── treasure.py         # 宝物模型，定义宝物的数据结构
│   └── utils                   # 工具函数目录
│       ├── config_writer.py    # 配置写入工具
│       ├── enhanced_logger.py  # 增强日志记录器
│       ├── json_loader.py      # JSON加载工具
│       ├── parallel_config.py  # 并行配置工具
│       ├── path_utils.py       # 路径处理工具
│       ├── text_splitter.py    # 文本分割工具
│       ├── thread_monitor.py   # 线程监控工具
│       └── unified_id_processor.py  # 统一ID处理器
├── debug                       # 调试文件目录
│   ├── api_response.json       # API响应调试数据
│   ├── extracted_events.json   # 提取的事件调试数据
│   ├── extracted_events_test.json  # 测试事件调试数据
│   └── optimized_vs_original.json  # 优化前后对比数据
├── docs                        # 文档目录
│   ├── README.md               # 文档说明
│   ├── 代码结构设计.md         # 代码结构设计文档
│   ├── 开发方案.md             # 开发方案文档
│   ├── 理论支持.md             # 理论支持文档
│   └── 项目逻辑设计.md         # 项目逻辑设计文档
├── graph_builder               # 图谱构建模块，将因果关系转换为可视化图谱
│   ├── app.py                  # 模块入口文件
│   ├── controller              # 控制器目录
│   │   └── graph_controller.py # 图谱控制器，处理图谱生成请求
│   ├── domain                  # 领域模型目录
│   │   └── base_renderer.py    # 渲染器基类
│   ├── service                 # 服务目录
│   │   └── mermaid_renderer.py # Mermaid格式图表渲染服务
│   └── utils                   # 工具函数目录
│       └── color_map.py        # 色彩映射工具，为节点和边分配颜色
├── hallucination_refine        # 幻觉修复模块，检测和修复AI提取的幻觉
│   ├── app.py                  # 模块入口文件
│   ├── controller              # 控制器目录
│   │   └── har_controller.py   # 幻觉修复控制器
│   ├── di                      # 依赖注入目录
│   │   └── provider.py         # 依赖注入提供者
│   ├── domain                  # 领域模型目录
│   │   └── base_refiner.py     # 修复器基类
│   ├── repository              # 数据仓库目录
│   └── service                 # 服务目录
│       └── har_service.py      # 幻觉修复服务实现
├── log_doc                     # 项目日志和文档目录
│   ├── tree_compare.md         # 文件树比较文档
│   ├── 代码冗余合并优化报告.md    # 代码冗余合并优化的报告
│   ├── 修复计划.md              # 系统修复计划
│   ├── 因果图逻辑改造.md         # 因果图逻辑改造文档
│   ├── 并行处理优化总结报告.md    # 并行处理优化总结报告
│   ├── 并行处理优化报告.md       # 并行处理优化详细报告
│   ├── 测试修复完成报告.md       # 测试修复完成情况报告
│   └── 脚本整合优化报告.md       # 脚本整合优化报告
├── main.py                     # 系统主入口文件，包含命令行接口和核心流程控制
├── novel                       # 小说文本目录
│   ├── 1.txt                   # 小说章节文件1
│   ├── 2.txt                   # 小说章节文件2
│   └── test.txt                # 测试用小说文本
├── output_2025-06-10_23-06-58  # 输出结果目录，按时间命名
├── pytest.ini                  # pytest测试框架配置文件
├── reports                     # 报告目录
│   ├── parallel_config_report_20250611_001707.md  # 并行配置报告
│   ├── parallel_config_report_20250611_001915.md  # 并行配置报告
│   ├── parallel_config_report_20250611_002013.md  # 并行配置报告
│   └── parallel_config_report_20250611_215755.md  # 并行配置报告
├── requirements.txt            # 项目依赖库清单
├── scripts                     # 实用脚本目录
│   ├── check_env.py            # 环境检查脚本
│   ├── complete_test.py        # 完整测试脚本
│   ├── fix_ids.py              # ID修复脚本
│   ├── refactor_demo.py        # 重构演示脚本
│   ├── run_demo.py             # 运行演示脚本
│   ├── test_api_integration.py # API集成测试脚本
│   ├── test_candidate_generator.py  # 候选生成器测试脚本
│   ├── test_causal_linking_optimized.py  # 优化的因果链接测试脚本
│   ├── test_event_extraction.py  # 事件提取测试脚本
│   ├── test_linker.py          # 链接器测试脚本
│   ├── test_smart_candidate_generator.py  # 智能候选生成器测试脚本
│   └── unified_parallel_tool.py  # 统一并行工具脚本
├── temp                        # 临时文件目录
│   ├── duplicate_events_test.json  # 重复事件测试数据
│   ├── fixed_events_test.json  # 修复后的事件测试数据
│   └── fixed_ids.json          # 修复后的ID数据
├── tests                       # 测试目录
│   ├── PROJECT_COMPLETION_SUMMARY.md  # 项目完成摘要
│   ├── README.md               # 测试说明文档
│   ├── api_tests               # API测试目录
│   │   ├── README.md           # API测试说明
│   │   ├── fix_api_tests.py    # API测试修复脚本
│   │   ├── test_api_integration.new.py  # 新版API集成测试
│   │   ├── test_api_integration.py  # API集成测试
│   │   └── test_api_integration_improved.py  # 改进的API集成测试
│   ├── causal_linking_tests    # 因果链接测试目录
│   │   ├── test_candidate_generator.py  # 候选生成器测试
│   │   ├── test_causal_linking_optimized.py  # 优化的因果链接测试
│   │   ├── test_linker.py      # 链接器测试
│   │   └── test_smart_candidate_generator.py  # 智能候选生成器测试
│   ├── event_extraction_tests  # 事件提取测试目录
│   │   └── test_event_extraction.py  # 事件提取测试
│   ├── integration_tests       # 集成测试目录
│   │   └── complete_test.py    # 完整集成测试
│   ├── run_all_tests.new.py    # 新版运行所有测试脚本
│   ├── run_all_tests.py        # 运行所有测试脚本
│   ├── stage_1                 # 第1阶段测试（接口与模型）
│   │   ├── Stage_1_Test_Report.md  # 第1阶段测试报告
│   │   ├── __init__.py         # 包初始化文件
│   │   ├── run_tests.py        # 运行测试脚本
│   │   ├── test_interfaces.py  # 接口测试
│   │   └── test_models.py      # 模型测试
│   ├── stage_2                 # 第2阶段测试（文本摄取与事件提取）
│   │   ├── Stage_2_Test_Report.md  # 第2阶段测试报告
│   │   ├── __init__.py         # 包初始化文件
│   │   ├── run_tests.py        # 运行测试脚本
│   │   ├── test_event_extraction.py  # 事件提取测试
│   │   └── test_text_ingestion.py  # 文本摄取测试
│   ├── stage_3                 # 第3阶段测试（幻觉修复测试）
│   │   ├── STAGE3_COMPREHENSIVE_TEST_REPORT.md  # 第3阶段综合测试报告
│   │   ├── Stage_3_Test_Report.md  # 第3阶段测试报告
│   │   ├── __init__.py         # 包初始化文件
│   │   ├── run_tests.py        # 运行测试脚本
│   │   └── test_hallucination_refine.py  # 幻觉修复测试
│   ├── stage_4                 # 第4阶段测试（因果关系链接测试）
│   │   ├── Stage_4_Test_Report.md  # 第4阶段测试报告
│   │   ├── __init__.py         # 包初始化文件
│   │   ├── run_tests.py        # 运行测试脚本
│   │   ├── test_causal_linking.py.bak  # 因果链接测试备份
│   │   ├── test_cpc_module.py.bak  # CPC模块测试备份
│   │   └── test_unified_cpc.py  # 统一CPC测试
│   ├── stage_5                 # 第5阶段测试（图形构建测试）
│   │   ├── Stage_5_Test_Report.md  # 第5阶段测试报告
│   │   ├── __init__.py         # 包初始化文件
│   │   ├── run_tests.py        # 运行测试脚本
│   │   ├── test_color_map.py   # 色彩映射测试
│   │   ├── test_graph_builder_integration.py  # 图形构建集成测试
│   │   ├── test_graph_controller.py  # 图形控制器测试
│   │   └── test_mermaid_renderer.py  # Mermaid渲染器测试
│   ├── stage_6                 # 第6阶段测试（API网关和端到端集成测试）
│   │   ├── Stage_6_Test_Report.md  # 第6阶段测试报告
│   │   ├── __init__.py         # 包初始化文件
│   │   ├── run_tests.py        # 运行测试脚本
│   │   ├── test_api_gateway_cli.py  # API网关CLI测试
│   │   └── test_end_to_end_integration.py  # 端到端集成测试
│   └── utils_tests             # 工具测试目录
│       └── test_check_env.py   # 环境检查测试
├── text_ingestion             # 文本摄取模块，负责读取和处理原始文本
│   ├── app.py                 # 模块入口文件
│   └── chapter_loader.py      # 章节加载器，处理小说章节的加载和预处理
├── tree                       # 文件树生成工具
├── 常用命令.md                # 记录常用的开发和运行命令
├── 要处理的问题.md            # 列出当前系统存在的问题和待解决的挑战
└── 项目逻辑设计.md            # 详细描述项目的总体设计和逻辑流程
```

## 主要模块说明

1. **api_gateway**: API网关模块，提供统一的HTTP API接口
2. **causal_linking**: 因果关系链接模块，识别事件之间的因果关系
3. **common**: 公共组件目录，包含各模块共用的工具和接口
4. **graph_builder**: 图谱构建模块，将因果关系转换为可视化图谱
5. **hallucination_refine**: 幻觉修复模块，检测和修复AI提取的幻觉
6. **text_ingestion**: 文本摄取模块，负责读取和处理原始文本
7. **tests**: 测试目录，包含各种层级的测试

## 文件组织特点

- 每个功能模块都有自己的目录，采用相似的内部组织结构
- 清晰的层次结构：控制器(controller) -> 服务(service) -> 领域(domain)
- 配置文件集中在common/config目录下
- 测试代码按阶段和模块分类组织
- 文档分散在多个位置，包括根目录、docs目录和log_doc目录

## 最佳实践

- 使用依赖注入模式解耦组件
- 接口定义与实现分离
- 每个模块都有明确的职责边界
- 详细的日志记录和报告生成
- 完整的测试覆盖，包括单元测试和集成测试
